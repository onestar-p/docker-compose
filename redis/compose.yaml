services:
  redis:
    image: redis:7
    container_name: redis  # 容器名称
    restart: always  # 容器自动重启
    ports:
      - "6379:6379"  # 端口映射：主机端口:容器端口
    command:
      # 使用自定义配置文件启动
      - redis-server
      - /etc/redis/redis.conf
      # 设置密码（也可以在配置文件中设置）
      - --requirepass
      - redis123456
    volumes:
      # 挂载数据目录，持久化 Redis 数据
      - ../datas/redis/data:/data
      # 挂载配置文件
      - ./config/redis.conf:/etc/redis/redis.conf
      # 挂载日志目录
      - ../logs/redis:/var/log/redis
    environment:
      # 时区设置
      - TZ=Asia/Shanghai
    healthcheck:
      # 健康检查：使用 redis-cli ping 命令检查 Redis 是否可用
      test: ["CMD", "redis-cli", "-a", "redis123456", "ping"]
      interval: 10s  # 每 10 秒检查一次
      timeout: 5s  # 超时时间 5 秒
      retries: 3  # 重试 3 次
      start_period: 10s  # 启动后 10 秒开始健康检查
    networks:
      - redis-net  # 加入自定义网络

# 自定义网络配置
networks:
  redis-net:
    driver: bridge  # 使用桥接网络模式

